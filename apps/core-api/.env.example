PORT=4000
# Mandatory database (2 DB model)
OPS_DB_URL=postgresql://postgres:postgres@localhost:5432/balisnaptrip_ops
CHANNEL_DB_URL=postgresql://postgres:postgres@localhost:5432/balisnaptrip_channel

# Optional source DB override (default fallback = OPS_DB_URL)
# BALISNAP_DB_URL=postgresql://postgres:postgres@localhost:5432/balisnap_db
# BSTADMIN_DB_URL=postgresql://postgres:postgres@localhost:5432/bstadmin_db

# Legacy aliases still accepted:
# DATABASE_URL -> OPS_DB_URL
# SYNC_DATABASE_URL -> CHANNEL_DB_URL (runtime service)
# Script fallback candidates (batch C/D/E): balisnap/.env DATABASE_URL, bstadmin/.env(.production) DATABASE_URL
REDIS_URL=redis://localhost:6379
PRECHECK_DISK_TOTAL_BYTES=100000000000
PRECHECK_DISK_USED_BYTES=60000000000
PHASE2_BATCH_CODE=A
PHASE2_DRY_RUN=true
CORE_API_BASE_URL=http://localhost:4000
ADMIN_AUTH_ENABLED=true
CORE_API_ADMIN_TOKEN=dev-admin-token
CORE_API_ADMIN_ROLE=ADMIN
EXPECT_ADMIN_AUTH_ENFORCED=true

# Ingest security + feature flags
INGEST_SERVICE_TOKEN=dev-service-token
INGEST_SERVICE_SECRET=dev-service-secret
INGEST_TIMESTAMP_DRIFT_MINUTES=5
INGEST_NONCE_TTL_MINUTES=10
INGEST_IDEMPOTENCY_TTL_DAYS=35
INGEST_WEBHOOK_ENABLED=false
INGEST_QUEUE_ENABLED=false
INGEST_REPLAY_ENABLED=false
INGEST_SYNC_FALLBACK_ENABLED=false
INGEST_QUEUE_NAME=ingest-bookings-events
INGEST_REDIS_URL=redis://localhost:6379

# Retention runtime
INGEST_RETENTION_ENABLED=true
INGEST_RETENTION_RUN_ON_START=false
INGEST_RETENTION_INTERVAL_MS=86400000
INGEST_DLQ_RETENTION_DAYS=30
INGEST_UNMAPPED_RETENTION_DAYS=90

# Audit persistence
AUDIT_PERSISTENCE_ENABLED=true
AUDIT_LOG_PATH=reports/audit/audit-events.ndjson

# Catalog publish workflow
CATALOG_PUBLISH_PERSISTENCE_ENABLED=true
CATALOG_PUBLISH_JOBS_PATH=reports/publish/catalog-jobs.ndjson
CATALOG_PUBLISH_DIR=reports/publish/catalog
CATALOG_PUBLISH_SECRET=
CATALOG_PUBLISH_SIGNATURE_REQUIRED=false
CATALOG_PUBLISH_TIMESTAMP_DRIFT_MINUTES=5
CATALOG_PUBLISH_NONCE_TTL_MINUTES=10
CATALOG_PUBLISH_REVIEWER_MUST_DIFFER_FROM_CREATOR=false
CATALOG_PUBLISH_PUBLISHER_MUST_DIFFER_FROM_REVIEWER=false
GATE_CATALOG_PUBLISH_TIMEOUT_MS=15000
GATE_CATALOG_PUBLISH_RUN_FAILED_SCENARIO=true
GATE_CATALOG_PUBLISH_EXPECT_SIGNATURE_REQUIRED=false

# Gate runner (optional overrides)
RUN_GATE_PROCESSING=true
RUN_GATE_DLQ_GROWTH=true
RUN_GATE_DUPLICATE_DELIVERY=false
RUN_GATE_RETENTION_POLICY=false
RUN_GATE_REPLAY_DRILL=false
GATE_PROCESSING_WINDOW_MINUTES=60
GATE_PROCESSING_MIN_SUCCESS_RATE=0.995
GATE_PROCESSING_MAX_MEDIAN_MS=3000
GATE_PROCESSING_MAX_P95_MS=15000
GATE_DLQ_WINDOW_MINUTES=120
GATE_DLQ_SAMPLE_INTERVAL_SECONDS=60
GATE_DLQ_MAX_GROWTH_PER_HOUR=20
GATE_DLQ_MAX_FETCH_ERRORS=0
GATE_DLQ_INCLUDE_STATUSES=OPEN,READY,REPLAYING,FAILED
GATE_DUPLICATE_MAX_EXCESS_ROWS=0
GATE_DUPLICATE_REQUIRE_INDEXES=true
GATE_RETENTION_REQUIRED_NONCE_TTL_MINUTES=10
GATE_RETENTION_REQUIRED_IDEMPOTENCY_TTL_DAYS=35
GATE_RETENTION_REQUIRED_DLQ_RETENTION_DAYS=30
GATE_RETENTION_MAX_STALE_DLQ_ROWS=0
GATE_RETENTION_MAX_STALE_INGEST_ROWS=0
INGEST_REPLAY_DRILL_ACTOR=ingest-replay-drill
INGEST_REPLAY_DRILL_POLL_INTERVAL_MS=1000
INGEST_REPLAY_DRILL_POLL_TIMEOUT_MS=45000
INGEST_REPLAY_DRILL_REQUEST_TIMEOUT_MS=10000
INGEST_REPLAY_DRILL_AUDIT_LIMIT=200

# Payment-finance bridge (Batch E)
PAYMENT_BACKFILL_DRY_RUN=false
GATE_PAYMENT_MAX_OPS_DONE_NOT_PAID_RATIO_PERCENT=0.3
GATE_PAYMENT_DIRECT_SAMPLE_SIZE=25

# API health metrics + gate (global G-03)
API_METRICS_MAX_SAMPLES=20000
GATE_API_WINDOW_MINUTES=15
GATE_API_MAX_5XX_RATE=0.015
GATE_API_MIN_REQUESTS=1
GATE_API_REQUEST_TIMEOUT_MS=10000

# Reconciliation metrics + daily report (T-011-03)
RECON_MAX_GLOBAL_MISMATCH_RATIO=0.01
QUALITY_MAX_OPS_DONE_NOT_PAID_RATIO=0.01
QUALITY_MAX_UNMAPPED_RATIO_PERCENT=5
RECON_REPORT_FAIL_ON_CHECKS=true
RECON_REPORT_REQUEST_TIMEOUT_MS=10000

# Release evidence toggles
RUN_EVIDENCE_QUALITY_CHECK=true
RUN_EVIDENCE_INGEST_GATES=true
RUN_EVIDENCE_INGEST_REPLAY_DRILL=false
RUN_EVIDENCE_INGEST_DUPLICATE_GATE=false
RUN_EVIDENCE_INGEST_RETENTION_GATE=false
RUN_EVIDENCE_CATALOG_GATE=false
RUN_EVIDENCE_BOOKING_GATE=false
RUN_EVIDENCE_PAYMENT_GATE=false
RUN_EVIDENCE_CATALOG_PUBLISH_GATE=false
